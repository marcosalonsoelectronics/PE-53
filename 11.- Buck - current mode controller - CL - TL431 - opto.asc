Version 4
SHEET 1 2868 2068
WIRE 736 -288 672 -288
WIRE 896 -288 816 -288
WIRE 1024 -288 896 -288
WIRE 1152 -288 1024 -288
WIRE 1248 -288 1152 -288
WIRE 1760 -288 1616 -288
WIRE 896 -256 896 -288
WIRE 1760 -256 1760 -288
WIRE -384 -192 -416 -192
WIRE -96 -192 -384 -192
WIRE 1024 -192 1024 -288
WIRE 1248 -176 1248 -288
WIRE 896 -160 896 -192
WIRE -96 -144 -96 -192
WIRE 1760 -144 1760 -176
WIRE 1616 -128 1616 -288
WIRE -192 -64 -224 -64
WIRE -144 -64 -192 -64
WIRE 896 -32 896 -80
WIRE 1024 -32 1024 -128
WIRE -416 16 -416 -192
WIRE 1248 32 1248 -96
WIRE 1280 32 1248 32
WIRE 1360 32 1280 32
WIRE 1616 32 1616 -48
WIRE 1616 32 1552 32
WIRE 1680 32 1616 32
WIRE 1760 32 1680 32
WIRE 1808 32 1760 32
WIRE 1680 48 1680 32
WIRE -192 80 -224 80
WIRE -96 80 -96 -48
WIRE -96 80 -192 80
WIRE -16 80 -96 80
WIRE 176 80 16 80
WIRE 304 80 256 80
WIRE 448 80 384 80
WIRE 544 80 448 80
WIRE 576 80 544 80
WIRE 672 80 672 -288
WIRE 672 80 576 80
WIRE 928 128 864 128
WIRE 1072 128 1008 128
WIRE 1248 128 1136 128
WIRE 1280 128 1248 128
WIRE 1360 128 1280 128
WIRE 1584 128 1552 128
WIRE 1680 128 1680 112
WIRE 1680 128 1584 128
WIRE 448 144 448 80
WIRE 0 176 0 96
WIRE 48 176 0 176
WIRE 176 176 48 176
WIRE 576 176 576 80
WIRE 1248 176 1248 128
WIRE -96 192 -96 80
WIRE 672 224 672 80
WIRE 720 224 672 224
WIRE 864 224 864 128
WIRE 864 224 800 224
WIRE 1040 224 864 224
WIRE 1184 224 1040 224
WIRE 1200 224 1184 224
WIRE 448 240 448 208
WIRE 1040 304 1040 224
WIRE 1584 336 1584 128
WIRE -416 368 -416 96
WIRE -96 368 -96 256
WIRE -96 368 -416 368
WIRE 448 368 448 320
WIRE 448 368 -96 368
WIRE 576 368 576 256
WIRE 576 368 448 368
WIRE -416 416 -416 368
WIRE 1040 480 1040 384
WIRE 1248 480 1248 272
WIRE 1248 480 1040 480
WIRE 48 512 -16 512
WIRE 96 512 48 512
WIRE 400 512 304 512
WIRE 432 512 400 512
WIRE 96 544 -16 544
WIRE 400 544 304 544
WIRE 432 544 400 544
WIRE 96 576 64 576
WIRE 400 576 304 576
WIRE 432 576 400 576
WIRE 64 608 64 576
WIRE 96 608 64 608
WIRE 400 608 304 608
WIRE 432 608 400 608
WIRE 1248 656 1248 480
WIRE -16 768 -16 544
WIRE 1808 768 1808 32
WIRE 1808 768 -16 768
FLAG -416 416 0
FLAG 544 80 out
FLAG -384 -192 in
FLAG 48 176 isense
FLAG 400 576 gate
FLAG 400 608 source
FLAG -192 -64 gate
FLAG -192 80 source
FLAG 48 512 isense
FLAG 400 512 isensa
FLAG 400 544 clk
FLAG 1248 656 0
FLAG 1584 336 0
FLAG 1760 -144 0
FLAG 1760 32 comp
FLAG 1184 224 ref
FLAG 1280 128 K
FLAG 1280 32 A
FLAG 896 -32 0
FLAG 1024 -32 0
FLAG 1152 -288 vz
SYMBOL ind 288 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 100µ
SYMBOL cap 432 144 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL res 560 160 R0
SYMATTR InstName R1
SYMATTR Value 5
SYMBOL voltage -416 0 R0
SYMATTR InstName V1
SYMATTR Value 10
SYMBOL res 272 64 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 50m
SYMBOL res 432 224 R0
SYMATTR InstName R3
SYMATTR Value 200m
SYMBOL Control\\isense 0 80 R0
WINDOW 0 0 -28 Bottom 2
WINDOW 3 42 37 Bottom 2
SYMATTR InstName U4
SYMATTR Value k=5
SYMBOL nmos -144 -144 R0
SYMATTR InstName M1
SYMATTR Value IRF530
SYMBOL Control\\idiode -80 256 R180
WINDOW 3 24 -28 Left 2
WINDOW 123 23 -58 Left 2
WINDOW 0 -44 35 Left 2
WINDOW 38 -62 3 Left 2
SYMATTR InstName U1
SYMBOL MyCMC 176 608 R0
WINDOW 3 -79 36 Left 2
WINDOW 123 -77 60 Left 2
WINDOW 39 -79 86 Left 2
SYMATTR Value2 ma={5*2.5e4}
SYMATTR InstName U2
SYMBOL res 1232 -192 R0
SYMATTR InstName R8
SYMATTR Value 400
SYMBOL res 1024 112 R90
WINDOW 0 -7 59 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 16k
SYMBOL cap 1136 112 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 10n
SYMBOL MyOpto 1456 80 R0
WINDOW 123 0 108 Center 2
WINDOW 39 0 136 Center 2
WINDOW 40 0 164 Center 2
SYMATTR InstName U6
SYMBOL res 1600 -144 R0
SYMATTR InstName R12
SYMATTR Value 7.6k
SYMBOL cap 1664 48 R0
SYMATTR InstName C3
SYMATTR Value 1p
SYMBOL voltage 1760 -272 R0
SYMATTR InstName Vcc1
SYMATTR Value 10
SYMBOL res 816 208 R90
WINDOW 0 -7 59 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 16k
SYMBOL MyTL431 1248 224 R0
SYMATTR InstName U3
SYMBOL res 1024 288 R0
SYMATTR InstName R7
SYMATTR Value 16k
SYMBOL res 832 -304 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100
SYMBOL diode 880 -256 R0
WINDOW 3 -113 61 Left 2
SYMATTR Value 1N4148
SYMATTR InstName D1
SYMBOL voltage 896 -176 R0
SYMATTR InstName V2
SYMATTR Value 3.3
SYMBOL cap 1008 -192 R0
SYMATTR InstName C4
SYMATTR Value 1µ
TEXT 72 -56 Left 2 !.tran 1m uic
TEXT 80 -96 Left 2 !.options reltol=1m
TEXT 72 424 Left 2 ;Current-Mode Controller
